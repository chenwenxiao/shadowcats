define(["editor","coffeescript","jquery","solve"],function(editor,coffeescript,$,solve){$("#run").click(function(){var compiledJS,session=editor.getSession(),coffeeCode=session.getDocument().getValue().split("\n"),realCode="";for(var code in coffeeCode){var str=coffeeCode[code];" "!=str[0]&&"	"!=str[0]&&(realCode+="solve.setIndex "+code+" \n"),realCode+=coffeeCode[code]+"\n"}compiledJS=coffeescript.compile(realCode,{bare:!0}),solve.init(),eval(compiledJS),solve.startAnimate()})}),define(["ace/ace","jquery"],function(e,t){var i=e.edit("editor");return i.setTheme("ace/theme/twilight"),i.session.setMode("ace/mode/coffee"),i}),require.config({paths:{ace:"../libs/ace-build/src",bootstrap:"../libs/bootstrap/dist/js/bootstrap",jquery:"../libs/jquery/dist/jquery",snapsvg:"../libs/Snap.svg/dist/snap.svg",coffeescript:"../libs/coffee-script/extras/coffee-script"}}),define(["compile","bootstrap"],function(e,t){}),define(["jquery"],function(e){var t=e("#map").text(),i=JSON.parse(t);return i});var box2d;collie.util.addEventListener(window,"load",function(){oConsole=new collie.FPSConsole({isSimple:!0,color:"#fff"});var e=collie.util.queryString(),t={width:document.body.clientWidth,height:document.body.clientHeight};collie.Renderer.DEBUG_RENDERING_MODE="undefined"!=typeof e.dom?"dom":"undefined"!=typeof e.canvas?"canvas":"auto",collie.Renderer.RETINA_DISPLAY=!1,collie.ImageManager.add("yame","/images/yame_walk.png");var i=new collie.Layer({width:t.width,height:t.height});box2d=new collie.Box2d(t.width,t.height,30),box2d.addFixture("rabbit",{density:1,friction:.5,restitution:0}),box2d.addFixture("ground",{density:1,friction:.5,restitution:.2}),box2d.createWall("right"),box2d.createWall("left"),box2d.createWall("top"),box2d.createWall("bottom","ground");for(var o,r,n,a=0;2>a;a++)o=new collie.DisplayObject({width:129.4,height:165,x:Math.random()*(t.width-129.4)|0,y:Math.random()*(t.height-165)|0,useEvent:!0,backgroundImage:"yame",hitArea:[[48,51],[46,13],[54,14],[56,45],[70,45],[70,16],[79,16],[79,52],[81,131],[81,140],[69,141],[66,117],[65,142],[53,144],[52,111],[45,97],[44,74]]}).addTo(i),collie.Timer.cycle(o,"18fps",{to:8}),r=box2d.createObject(o,{width:50,height:130},"rabbit");n=r,n.SetFixedRotation(!0);var d={left:!1,right:!1},s=null;i.attach({mousedown:function(e){if(e.displayObject){var t=box2d.getBody(e.displayObject);s=box2d.createMouseJoint(t,collie.Box2d.vec2(e.x,e.y,!0),{maxForce:300*t.GetMass()}),t.SetAwake(!0)}},mousemove:function(e){s&&s.SetTarget(collie.Box2d.vec2(e.x,e.y,!0))},mouseup:function(e){s&&(box2d.removeJoint(s),s=null)},click:function(e){var t=new collie.DisplayObject({width:129.4,height:165,x:e.x-64.7,y:e.y-82.5,useEvent:!0,backgroundImage:"yame",hitArea:[[48,51],[46,13],[54,14],[56,45],[70,45],[70,16],[79,16],[79,52],[81,131],[81,140],[69,141],[66,117],[65,142],[53,144],[52,111],[45,97],[44,74]]}).addTo(i);collie.Timer.cycle(t,"18fps",{to:8});box2d.createObject(t,{width:50,height:130},"rabbit")}}),collie.util.addEventListener(document.body,"keydown",function(e){var t=e.keyCode||e.key.charCodeAt(0);switch(n.SetAwake(!0),t){case 68:d.right=!0;break;case 65:d.left=!0;break;case 87:var i=n.GetLinearVelocity();n.SetLinearVelocity(collie.Box2d.vec2(i.x,-15),n.GetWorldCenter())}}),collie.util.addEventListener(document.body,"keyup",function(e){var t=e.keyCode||e.key.charCodeAt(0),i=n.GetLinearVelocity();switch(t){case 68:d.right=!1,n.SetLinearVelocity(collie.Box2d.vec2(0,i.y));break;case 65:d.left=!1,n.SetLinearVelocity(collie.Box2d.vec2(0,i.y))}}),oConsole.load(),collie.Renderer.addLayer(i),collie.Renderer.load(document.getElementById("collie_container")),collie.Renderer.start("30fps",function(){var e=n.GetLinearVelocity();d.left&&n.SetLinearVelocity(collie.Box2d.vec2(-10,e.y)),d.right&&n.SetLinearVelocity(collie.Box2d.vec2(10,e.y))}),box2d.load(!1)}),define(["map","view","editor"],function(e,t,i){var o={player:void 0,map:e,view:t,round:0,index:[],startAnimate:function(){var r=setInterval(function(){o.round<e.round?(t.startAnimate(o.round),o.round++,i.getSession().clearBreakpoints(),i.getSession().setBreakpoint(o.index[o.round])):clearInterval(r)},50)},init:function(){e.round=0,o.round=0,e.index=0,o.index=[],t.init(e),o.player=o.findPlayers()[0]},strife:function(e,t){return(t.x<e.x+e.width&&t.x>=e.x||e.x<t.x+t.width&&e.x>=t.x)&&(t.y<e.y+e.height&&t.y>=e.y||e.y<t.y+t.height&&e.y>=t.y)?!0:!1},judge:function(t){var i=[];for(var r in e.items)o.strife(e.items[r],t)&&t.id!=r&&i.push(e.items[r]);return i},move:function(e){if(!e.move)return!e.stable;if(e._use)return!0;e._use=!0,e.x+=e.vx,e.y+=e.vy;var t=o.judge(e),i=!0;for(var r in t)t[r].move&&(t[r].vx+=e.vx,t[r].vy+=e.vy),o.move(t[r])||(i=!1);return i||(e.x-=e.vx,e.y-=e.vy,e.vx=0,e.vy=0),e._use=!1,i},_move:function(e){if(null!=e.ladder)e.x+=e.vx,o.strife(e,o.findId(e.ladder))||(e.x-=e.vx),e.y+=e.vy,o.strife(e,o.findId(e.ladder))||(e.y-=e.vy),t.move(e);else{var i=e.vx,r=e.vy;e.vx=i,e.vy=0,o.move(e),i=e.vx,e.vx=0,e.vy=r,o.move(e),r=e.vy,e.vx=i,e.vy=r,t.move(e)}},setIndex:function(t){e.index=t},finish:function(){var t;for(t in e.items)e.items[t].gravity&&(e.items[t].vy+=3);for(t in e.items)e.items[t].move&&o._move(e.items[t]);o.index.push(e.index),e.round++;for(t in e.items)e.items[t].move&&(e.items[t].vx>0&&(e.items[t].vx-=2),e.items[t].vx<0&&(e.items[t].vx+=2),e.items[t].vy>0&&(e.items[t].vy-=2),e.items[t].vy<0&&(e.items[t].vy+=2))},use:function(e){var i;if(e._use=!0,"knob"==e.type){for(i in e.targets)e.targets[i]._use||o.use(o.findId(e.targets[i]));t.use(e),e.status=!e.status}"door"==e.type&&(e.status?e.status=e.stable=!1:e.status=e.stable=!0,t.use(e)),"ladder"==e.type&&(o.player.ladder==e.id?(o.player.gravity=!0,o.player.ladder=null):(o.player.gravity=!1,o.player.ladder=e.id)),e._use=!1},sleep:function(e){for(var t=(new Date).getTime(),i=t;e>i-t;)i=(new Date).getTime()},findId:function(t){var i;for(i in e.items)if(e.items[i].id==t)return e.items[i]},findPlayers:function(){var t,i=[];for(t in e.items)"player"==e.items[t].type&&i.push(e.items[t]);return i},left:function(e){for(var t=0;e>t;++t)o.player.vx-=2,o.finish()},right:function(e){for(var t=0;e>t;++t)o.player.vx+=2,o.finish()},up:function(e){for(var t=0;e>t;++t)null!=o.player.ladder&&(o.player.vy-=2),o.finish()},down:function(e){for(var t=0;e>t;++t)null!=o.player.ladder&&(o.player.vy-=2),o.finish()},useItem:function(e,t){for(var i=0;t>i;++i)o.strife(o.player,e)&&e.canuse&&o.use(e),o.finish()},wait:function(e){for(var t=0;e>t;++t)o.finish()}};return o.init(),o}),define(["map","jquery","snapsvg"],function(e,t,i){function o(e){c=[],l=[];var t=Snap("#svg"),i=t.paper.image(e.background.src,0,0,600,600);l.push(i);for(var o in e.items){var r=e.items[o];if("player"==r.type){var n=t.paper.image(r.src,r.x,r.y,r.width,r.height);l.push({id:r.id,obj:n,type:"player"})}else if("ground"==r.type){var a=t.paper.image(r.src,r.x,r.y,r.width,r.height);l.push({id:r.id,obj:a,type:"ground"})}else if("box"==r.type){var d=t.paper.image(r.src,r.x,r.y,r.width,r.height);l.push({id:r.id,obj:d,type:"box"})}else if("ladder"==r.type){var s=t.paper.image(r.src,r.x,r.y,r.width,r.height);l.push({id:r.id,obj:s,type:"ladder"})}else if("knob"==r.type){if(1==r.status)var u=t.paper.image(r.src,r.x,r.y,r.width,r.height);else var u=t.paper.image(r.src,r.x,r.y,r.width,r.height);l.push({id:r.id,obj:u,type:"knob"})}else if("door"==r.type){if(1==r.status)var f=t.paper.image(r.src,r.x,r.y,r.width,r.height);else var f=t.paper.image(r.src,r.x,r.y,r.width,r.height);l.push({id:r.id,obj:f,type:"door"})}else console.log("error, unknown item in initialization")}console.log("init...finished...")}function r(e,t,i){for(var o in l)if(e==l[o].id){var r=parseInt(l[o].obj.attr("x")),n=parseInt(l[o].obj.attr("y")),a=t,d=i;Snap.animate([r,n],[a,d],function(e){l[o].obj.attr({x:e[0],y:e[1]})},10);break}console.log("one move...done...")}function n(e){for(var t in l)if(e==l[t].id&&"door"==l[t].type){var i=parseInt(l[t].obj.attr("x")),o=parseInt(l[t].obj.attr("y")),r=0;Snap.animate(r+0,r+45,function(e){r=e,l[t].obj.transform((new Snap.Matrix).rotate(e,i,o))},1e3);break}console.log("one use...done...")}function a(e){null!=c[e]&&c[e].forEach(function(e){switch(e.type){case"move":r(e.id,e.x,e.y);break;case"use":n(e.id)}})}function d(t){for(;c.length<=e.round;)c.push([]);var i=!1;c[e.round].forEach(function(e){e.id==t.id&&"move"==e.type&&(i=!0,e.x=t.x,e.y+=t.y)}),i||c[e.round].push({id:t.id,x:t.x,y:t.y,type:"move"})}function s(t){for(;c.length<=e.round;)c.push([]);c[e.round].push({id:t.id,type:"use"})}var l=[],c=[];return{init:o,move:d,use:s,__use:n,startAnimate:a}});