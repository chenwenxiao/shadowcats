define(["editor","coffeescript","jquery","solve"],function(editor,coffeescript,$,solve){$("#run").click=function(){var compiledJS;compiledJS=coffeescript.compile(editor.editor.getSession().getDocument().getValue(),{bare:!0}),eval(compiledJS)}}),define(["ace","jquery"],function(e,t){var i=e.edit("editor");return i.setTheme("ace/theme/twilight"),i.session.setMode("ace/mode/javascript"),i}),require.config({paths:{ace:"public/libs/ace/lib/ace/ace.js",bootstrap:"public/libs/bootstrap/dist/js/bootstrap.js",jquery:"public/libs/jquery/dist/jquery.js",snapsvg:"public/libs/Snap.svg/dist/snap.svg.js",coffeescript:"public/libs/coffee-script/lib/coffee-script/coffee-script.js"}}),define(["compile","bootstrap"],function(e,t){}),define([],function(){var e={background:{src:""},items:[{type:player,id:0,x:100,y:100,width:100,height:100,stable:!1,gravity:!0,src:""},{type:ground,id:1,x:0,y:0,width:100,height:100,stable:!0,gravity:!1,src:""},{type:box,id:2,x:50,y:50,width:50,height:50,stable:!0,gravity:!0,move:!0,src:""},{type:ladder,id:3,x:100,y:100,width:100,height:100,stable:!1,gravity:!1,climb:!0,src:""},{type:knob,id:4,x:100,y:100,width:100,height:100,stable:!1,gravity:!0,targets:[5],status:!1,src:""},{type:door,id:5,x:100,y:100,width:100,height:100,stable:!0,gravity:!0,status:!0,src:""}]};return e});var box2d;collie.util.addEventListener(window,"load",function(){oConsole=new collie.FPSConsole({isSimple:!0,color:"#fff"});var e=collie.util.queryString(),t={width:document.body.clientWidth,height:document.body.clientHeight};collie.Renderer.DEBUG_RENDERING_MODE="undefined"!=typeof e.dom?"dom":"undefined"!=typeof e.canvas?"canvas":"auto",collie.Renderer.RETINA_DISPLAY=!1,collie.ImageManager.add("yame","/images/yame_walk.png");var i=new collie.Layer({width:t.width,height:t.height});box2d=new collie.Box2d(t.width,t.height,30),box2d.addFixture("rabbit",{density:1,friction:.5,restitution:0}),box2d.addFixture("ground",{density:1,friction:.5,restitution:.2}),box2d.createWall("right"),box2d.createWall("left"),box2d.createWall("top"),box2d.createWall("bottom","ground");for(var o,r,n,a=0;2>a;a++)o=new collie.DisplayObject({width:129.4,height:165,x:Math.random()*(t.width-129.4)|0,y:Math.random()*(t.height-165)|0,useEvent:!0,backgroundImage:"yame",hitArea:[[48,51],[46,13],[54,14],[56,45],[70,45],[70,16],[79,16],[79,52],[81,131],[81,140],[69,141],[66,117],[65,142],[53,144],[52,111],[45,97],[44,74]]}).addTo(i),collie.Timer.cycle(o,"18fps",{to:8}),r=box2d.createObject(o,{width:50,height:130},"rabbit");n=r,n.SetFixedRotation(!0);var c={left:!1,right:!1},l=null;i.attach({mousedown:function(e){if(e.displayObject){var t=box2d.getBody(e.displayObject);l=box2d.createMouseJoint(t,collie.Box2d.vec2(e.x,e.y,!0),{maxForce:300*t.GetMass()}),t.SetAwake(!0)}},mousemove:function(e){l&&l.SetTarget(collie.Box2d.vec2(e.x,e.y,!0))},mouseup:function(e){l&&(box2d.removeJoint(l),l=null)},click:function(e){var t=new collie.DisplayObject({width:129.4,height:165,x:e.x-64.7,y:e.y-82.5,useEvent:!0,backgroundImage:"yame",hitArea:[[48,51],[46,13],[54,14],[56,45],[70,45],[70,16],[79,16],[79,52],[81,131],[81,140],[69,141],[66,117],[65,142],[53,144],[52,111],[45,97],[44,74]]}).addTo(i);collie.Timer.cycle(t,"18fps",{to:8});box2d.createObject(t,{width:50,height:130},"rabbit")}}),collie.util.addEventListener(document.body,"keydown",function(e){var t=e.keyCode||e.key.charCodeAt(0);switch(n.SetAwake(!0),t){case 68:c.right=!0;break;case 65:c.left=!0;break;case 87:var i=n.GetLinearVelocity();n.SetLinearVelocity(collie.Box2d.vec2(i.x,-15),n.GetWorldCenter())}}),collie.util.addEventListener(document.body,"keyup",function(e){var t=e.keyCode||e.key.charCodeAt(0),i=n.GetLinearVelocity();switch(t){case 68:c.right=!1,n.SetLinearVelocity(collie.Box2d.vec2(0,i.y));break;case 65:c.left=!1,n.SetLinearVelocity(collie.Box2d.vec2(0,i.y))}}),oConsole.load(),collie.Renderer.addLayer(i),collie.Renderer.load(document.getElementById("collie_container")),collie.Renderer.start("30fps",function(){var e=n.GetLinearVelocity();c.left&&n.SetLinearVelocity(collie.Box2d.vec2(-10,e.y)),c.right&&n.SetLinearVelocity(collie.Box2d.vec2(10,e.y))}),box2d.load(!1)}),define(["map","view"],function(e,t){var i={map:e,view:t,simulate:{gravity:function(e){return e.gravity?move(e,0,1):!1},move:function(e,t,i){if(!e.move)return!1;e.x=e.x+t,e.y=e.y+i;var o,r=judge(e),n=!0;for(o in r)move(o,t,i)||(n=!1);return n||(e.x=e.x-t,e.y=e.y-i),!0}},init:function(){t.init(e),act.init()},judge:function(t){var i=[];for(var o in e.items)strife(o,t)&&i.push(o);return i},move:function(e,i,o){e.x=e.x+i,e.y=e.y+o;var r,n=judge(e);for(r in n)move(r,i,o);t.move(e,i,o)},_move:function(e,t,i){simulate.move(e,t,i)&&move(e,t,i)},gravity:function(e){move(e,0,1)},_gravity:function(e){simulate.gravity(e)&&gravity(e)},finish:function(){var i;for(i in e.items)_gravity(i);t.draw(e),wait(50)},use:function(e){var i;if(e._use=!0,"knob"==e.type){for(i in e.targets)i._use||use(i);t.use(e)}"door"==e.type&&(e.status?e.status=e.stable=!1:e.status=e.stable=!0,t.use(e,!1)),e._use=!1},wait:function(e){for(var t=(new Date).getTime(),i=t;e>i-t;)i=(new Date).getTime()},act:{init:function(){player=findPlayers()[0]},findPlayers:function(){var t,i=[];for(t in e.items)"player"==t.type&&i.push(t);return i},findStrifes:function(){var t,i=[];for(t in e.items)strife(player,t)&&i.push(t);return i},left:function(e){for(var t=0;e>t;++t)move(player,-1,0),finish()},right:function(e){for(var t=0;e>t;++t)move(player,1,0),finish()},up:function(e){for(var t=0;e>t;++t){var i,o=findStrifes();for(i in o)if(i.climb)return void move(player,0,-1);finish()}},down:function(e){for(var t=0;e>t;++t){var i,o=findStrifes();for(i in o)if(i.climb)return void move(player,0,1);finish()}},useItem:function(e,t){for(var i=0;t>i;++i)strife(player,e)&&use(e),finish()},wait:function(e){for(var t=0;e>t;++t)finish()}}};return i});